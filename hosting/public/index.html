<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Device Portal — Notifications & Location</title>
  <style>
    body { font-family: system-ui, Arial; max-width:820px; margin:18px auto; padding:18px; background:#f8fafc; color:#111; }
    .card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 8px 30px rgba(10,20,40,0.06); margin-bottom:12px; }
    button { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,#0b66ff,#0056d6); color:#fff; font-weight:600; }
    input { padding:10px; width:100%; border-radius:8px; border:1px solid #ddd; margin-top:8px; }
    #log { white-space:pre-wrap; background:#f7f9fc; padding:10px; border-radius:8px; height:220px; overflow:auto; color:#111; }
    .muted { color:#666; font-size:13px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Device Portal — Notifications & Location</h2>
    <p class="muted">This page requests location and notification permission and shows a test notification. Use it if you prefer a dedicated page to enable device features.</p>
  </div>

  <div class="card">
    <label>Email</label>
    <input id="email" placeholder="you@example.com" type="email" />
    <label>Password</label>
    <input id="password" placeholder="password" type="password" />
    <div style="display:flex; gap:8px; margin-top:10px;">
      <button id="signBtn" style="flex:1">Sign in (test)</button>
      <button id="regBtn" style="flex:1">Register (test)</button>
    </div>
    <div id="status" class="muted" style="margin-top:8px;">Not signed in</div>
  </div>

  <div class="card">
    <button id="enableBoth">Request Location & Notifications</button>
    <div id="coords" style="margin-top:10px;" class="muted">Location: —</div>
    <div id="perm" style="margin-top:6px;" class="muted">Notification permission: —</div>
  </div>

  <div class="card">
    <h4>Log</h4>
    <div id="log">Ready.</div>
  </div>

  <script>
    const logEl = document.getElementById('log');
    function log(t){ logEl.innerText = '[' + new Date().toLocaleTimeString() + '] ' + t + "\\n\\n" + logEl.innerText; }

    document.getElementById('enableBoth').addEventListener('click', async () => {
      log('Requesting geolocation...');
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude, lng = pos.coords.longitude;
          document.getElementById('coords').innerText = 'Location: ' + lat.toFixed(6) + ', ' + lng.toFixed(6);
          log('Got location: ' + lat + ',' + lng);
        }, err => {
          log('Geolocation error: ' + (err.message || err.code));
        }, { enableHighAccuracy:true, timeout:10000 });
      } else log('No geolocation support');

      log('Requesting notification permission...');
      try {
        const perm = await Notification.requestPermission();
        document.getElementById('perm').innerText = 'Notification permission: ' + perm;
        log('Notification permission: ' + perm);
        if (perm === 'granted') {
          new Notification('Notifications enabled', { body: 'You will receive notifications while this page is open.' });
        } else {
          log('Notifications not granted');
        }
      } catch(e) {
        log('Notification error: ' + e.message);
      }
    });

    // small test handlers for sign/register (no backend here)
    document.getElementById('signBtn').addEventListener('click', () => {
      const e = document.getElementById('email').value, p = document.getElementById('password').value;
      if(!e || !p) { alert('enter email & password'); return; }
      document.getElementById('status').innerText = 'Signed in (test): ' + e;
      log('Sign-in (test) for ' + e);
    });
    document.getElementById('regBtn').addEventListener('click', () => {
      const e = document.getElementById('email').value, p = document.getElementById('password').value;
      if(!e || p.length < 8) { alert('enter email and password >= 8 chars'); return; }
      document.getElementById('status').innerText = 'Registered (test): ' + e;
      log('Register (test) for ' + e);
    });
  </script>
</body>
</html>
